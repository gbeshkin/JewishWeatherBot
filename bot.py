import os
import random
import asyncio
import logging

from aiogram import Bot, Dispatcher, Router
from aiogram.filters import Command
from aiogram.types import Message

# -----------------------------
# CONFIG
# -----------------------------
BOT_TOKEN = os.getenv("BOT_TOKEN")
if not BOT_TOKEN:
    raise RuntimeError("BOT_TOKEN environment variable is missing")

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger("forecast-bot")

router = Router()

# -----------------------------
# CONTENT POOLS
# -----------------------------

MORNING_EVENTS = [
    "Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚Ñ‹",
    "Ñ‚ÑƒĞ¼Ğ°Ğ½ Ğ³Ñ€Ğ¾Ğ¼ĞºĞ¸Ñ… Ğ·Ğ°ÑĞ²Ğ»ĞµĞ½Ğ¸Ğ¹",
    "Ğ¿ĞµÑ€ĞµĞ¿Ğ°Ğ´Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğ¹ Ğ² ÑĞ¾Ñ†ÑĞµÑ‚ÑÑ…",
    "Ğ¾Ğ±Ğ»Ğ°ĞºĞ° ÑÑ€Ğ¾Ñ‡Ğ½Ñ‹Ñ… Ğ¼Ğ½ĞµĞ½Ğ¸Ğ¹",
    "Ğ¿Ğ¾Ñ€Ñ‹Ğ²Ñ‹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ² Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ°",
    "ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ Ğ²Ğ¾Ğ»Ğ½Ñ‹ Ğ²Ğ¾Ğ·Ğ¼ÑƒÑ‰ĞµĞ½Ğ¸Ñ",
]

MORNING_DESCRIPTIONS = [
    "ÑĞ²Ğ»ĞµĞ½Ğ¸Ğµ ÑˆÑƒĞ¼Ğ½Ğ¾Ğµ, Ğ½Ğ¾ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ñ€Ğ°ÑÑĞµĞ¸Ğ²Ğ°ÑÑ‰ĞµĞµÑÑ",
    "Ğ·Ğ²ÑƒÑ‡Ğ¸Ñ‚ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ¶Ğ½Ğ¾, Ğ½Ğ¾ Ğ²Ğ»Ğ¸ÑĞµÑ‚ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ğ¾",
    "Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ»Ğ¾Ñ‚Ğ½Ğ¾Ğµ, Ğ¿Ğ¾ ÑÑƒÑ‚Ğ¸ â€” Ğ²Ğ¾Ğ´ÑĞ½Ğ¸ÑÑ‚Ğ¾Ğµ",
    "ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ¾Ñ‰ÑƒÑ‰ĞµĞ½Ğ¸Ğµ ÑˆÑ‚Ğ¾Ñ€Ğ¼Ğ° Ğ¿Ñ€Ğ¸ ÑĞ»Ğ°Ğ±Ğ¾Ğ¼ Ğ²ĞµÑ‚Ñ€Ğµ",
]

DAY_EVENTS = [
    "Ğ²ÑĞ¿Ñ‹ÑˆĞºĞ¸ breaking news",
    "Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞ¸ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ¶Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¾Ğ²",
    "ÑĞºÑÑ‚Ñ€ĞµĞ½Ğ½Ñ‹Ğµ ÑĞºÑĞ¿ĞµÑ€Ñ‚Ğ½Ñ‹Ğµ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ñ‹",
    "ÑĞºĞ°Ñ‡ĞºĞ¸ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ†Ğ¸Ğ¹",
    "Ğ²Ğ½ĞµĞ·Ğ°Ğ¿Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ñ‹ Ğ¿Ğ¾Ğ²ĞµÑÑ‚ĞºĞ¸",
]

RECOMMENDATIONS = [
    "Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ·Ğ¾Ğ½Ñ‚ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ¼Ñ‹ÑˆĞ»ĞµĞ½Ğ¸Ñ",
    "Ğ½Ğµ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ğ² Ğ»ĞµĞ½Ñ‚Ñƒ Ğ±ĞµĞ· Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸",
    "Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¿ĞµÑ€ĞµĞ´ Ñ€ĞµĞ°ĞºÑ†Ğ¸ĞµĞ¹",
    "Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¿Ğ°ÑƒĞ·Ñƒ Ğ¼ĞµĞ¶Ğ´Ñƒ Â«Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ»Â» Ğ¸ Â«Ğ¿Ğ¾Ğ²ĞµÑ€Ğ¸Ğ»Â»",
    "Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ Ğ³Ñ€Ğ¾Ğ¼ĞºĞ¾ÑÑ‚ÑŒ â‰  Ğ²Ğ°Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ",
]

SOCIAL_TEMP = [
    "Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ½Ğ°Ñ",
    "Ğ½ĞµÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ°Ñ",
    "Ğ±Ğ»Ğ¸Ğ·ĞºĞ°Ñ Ğº Ğ¿ĞµÑ€ĞµĞ³Ñ€ĞµĞ²Ñƒ",
    "ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ½Ğ°ÑÑ‹Ñ‰ĞµĞ½Ğ½Ğ°Ñ",
]

INTL_PRESSURE = [
    "Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğµ",
    "Ğ¿Ğ¾Ñ€Ñ‹Ğ²Ğ¸ÑÑ‚Ğ¾Ğµ",
    "Ñ…Ñ€Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ½ĞµÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ",
    "Ğ´Ğ°Ğ²Ğ½Ğ¾ Ğ±ĞµĞ· ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ°",
]

UN_LEVEL = [
    "Ñ‚Ñ€Ğ°Ğ´Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ¾ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹",
    "Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ñ€ĞµĞºĞ¾Ñ€Ğ´Ğ½Ñ‹Ğ¹",
    "ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾ Ğ¾Ğ·Ğ°Ğ±Ğ¾Ñ‡ĞµĞ½Ğ½Ñ‹Ğ¹",
    "Ğ½Ğµ Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‰Ğ¸Ğ¹ Ğ¾Ñ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹",
]

EVENING_EVENTS = [
    "ÑˆĞ°Ğ±Ğ±Ğ°Ñ‚-Ğ±Ñ€Ğ¸Ğ·",
    "Ğ²ĞµÑ‡ĞµÑ€Ğ½ĞµĞµ Ğ·Ğ°Ñ‚Ğ¸ÑˆÑŒĞµ",
    "Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ñ… Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹",
    "Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğº Ñ‡ĞµĞ»Ğ¾Ğ²ĞµÑ‡ĞµÑĞºĞ¾Ğ¼Ñƒ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ñƒ",
]

EVENING_DESCRIPTIONS = [
    "ÑˆÑƒĞ¼ ÑĞ½Ğ¸Ğ¶Ğ°ĞµÑ‚ÑÑ, Ğ° ÑĞ¼Ñ‹ÑĞ» ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑÑ ÑĞ»Ñ‹ÑˆĞ½ĞµĞµ",
    "Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ´Ğ¾ Ğ»ÑƒÑ‡ÑˆĞ¸Ñ… Ğ²Ñ€ĞµĞ¼Ñ‘Ğ½",
    "Ñ‚ĞµĞ¼Ğ¿ Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚, Ğ¸ Ğ¼Ğ¸Ñ€ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ñ‘Ñ‚ ĞºÑ€Ğ¸Ñ‡Ğ°Ñ‚ÑŒ",
    "Ğ´Ğ°Ğ¶Ğµ ÑĞ¿Ğ¾Ñ€ÑÑ‰Ğ¸Ğµ Ğ²ÑĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ÑÑ‚, Ñ‡Ñ‚Ğ¾ Ğ¾Ğ½Ğ¸ Ğ»ÑĞ´Ğ¸",
]

LIGHT_PHRASES = [
    "Ğ´Ğ°Ğ¶Ğµ ÑĞ°Ğ¼Ñ‹Ğ¹ Ğ¿Ğ°ÑĞ¼ÑƒÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ· â€” Ğ½Ğµ Ğ¿Ğ¾Ğ²Ğ¾Ğ´ Ğ¾Ñ‚Ğ¼ĞµĞ½ÑÑ‚ÑŒ ÑĞ²ĞµÑ‚",
    "ÑĞ²ĞµÑ‚ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ´Ğ°ĞµÑ‚ÑÑ Ğ² Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°Ğ¼Ğ¸",
    "Ğ¸Ğ½Ğ¾Ğ³Ğ´Ğ° Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ÑĞ²ĞµÑ‡Ğ¸",
    "Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ° Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ, Ğ° ÑĞ²ĞµÑ‚ Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ",
    "Ğ¼Ğ¸Ñ€ ÑĞ»Ğ¾Ğ¶Ğ½ĞµĞµ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹ Ğ¸ Ñ‚ĞµĞ¿Ğ»ĞµĞµ Ğ»ĞµĞ½Ñ‚Ñ‹",
]

UNEXPECTED_LINES = [
    "ĞœĞ°Ğ³Ğ½Ğ¸Ñ‚Ğ½Ñ‹Ñ… Ğ±ÑƒÑ€ÑŒ Ğ½Ğµ Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ÑÑ, Ğ½Ğ¾ Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹.",
    "Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ·Ğ´Ñ€Ğ°Ğ²Ğ¾Ğ³Ğ¾ ÑĞ¼Ñ‹ÑĞ»Ğ° Ğ½Ğ¸Ğ·ĞºĞ°Ñ, Ğ½Ğ¾ Ğ½ĞµĞ½ÑƒĞ»ĞµĞ²Ğ°Ñ.",
    "ĞÑĞ°Ğ´ĞºĞ¸ Ğ² Ğ²Ğ¸Ğ´Ğµ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ² Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹ Ğ±ĞµĞ· Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ.",
]

# -----------------------------
# GENERATORS
# -----------------------------

def maybe(probability: float) -> bool:
    return random.random() < probability


def generate_classic_forecast() -> str:
    text = f"""
â˜ï¸ Ğ•Ğ²Ñ€ĞµĞ¹ÑĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ñ‹

Ğ£Ñ‚Ñ€Ğ¾Ğ¼ Ğ¾Ğ¶Ğ¸Ğ´Ğ°ÑÑ‚ÑÑ {random.choice(MORNING_EVENTS)} â€”
{random.choice(MORNING_DESCRIPTIONS)}.

Ğ”Ğ½Ñ‘Ğ¼ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹ {random.choice(DAY_EVENTS)},
Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ {random.choice(RECOMMENDATIONS)}.

ğŸŒ¡ Ğ¢ĞµĞ¼Ğ¿ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ğ° Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ½ĞµĞ½Ğ¸Ñ â€” {random.choice(SOCIAL_TEMP)}
ğŸŒ Ğ”Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´ÑƒĞ½Ğ°Ñ€Ğ¾Ğ´Ğ½Ğ¾Ğµ â€” {random.choice(INTL_PRESSURE)}
ğŸ“Š Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¾Ğ·Ğ°Ğ±Ğ¾Ñ‡ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ ĞĞĞ â€” {random.choice(UN_LEVEL)}

Ğš Ğ²ĞµÑ‡ĞµÑ€Ñƒ â€” {random.choice(EVENING_EVENTS)}:
{random.choice(EVENING_DESCRIPTIONS)}.
""".strip()

    if maybe(0.3):
        text += f"\n\n{random.choice(UNEXPECTED_LINES)}"

    text += f"\n\nĞ‘ĞµÑ€ĞµĞ³Ğ¸Ñ‚Ğµ ÑĞµĞ±Ñ Ğ¸ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚Ğµ:\n{random.choice(LIGHT_PHRASES)}"
    return text


def generate_philosophical_forecast() -> str:
    return f"""
ğŸŒ¥ Ğ¤Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„ÑĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·

Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½ÑÑˆĞ½ÑÑ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ° ÑĞ¾ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¸Ğ· ÑĞ»Ğ¾Ğ².
Ğ˜Ñ… Ğ¼Ğ½Ğ¾Ğ³Ğ¾, Ğ¾Ğ½Ğ¸ Ñ‚ÑĞ¶Ñ‘Ğ»Ñ‹Ğµ Ğ¸ Ğ¿Ğ°Ğ´Ğ°ÑÑ‚ Ğ±ĞµĞ· Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€Ğ°.

ĞĞ±Ñ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğµ Ğ´Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‰ÑƒÑ‰Ğ°ĞµÑ‚ÑÑ,
Ğ½Ğ¾ Ğ¾Ğ½Ğ¾ Ğ½Ğµ Ğ¾Ñ‚Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… Ğ²ĞµÑ‰ĞµĞ¹ â€”
Ñ‚Ğ¸ÑˆĞ¸Ğ½Ñ‹, ÑĞ²ĞµÑ‚Ğ° Ğ¸ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´ÑƒĞ¼Ğ°Ñ‚ÑŒ.

Ğš Ğ²ĞµÑ‡ĞµÑ€Ñƒ Ğ¼Ğ¸Ñ€ ÑĞ»ĞµĞ³ĞºĞ° Ğ²Ñ‹Ğ´Ñ‹Ñ…Ğ°ĞµÑ‚.
ĞĞµ Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ°Ğ»Ğ¾ Ğ»ÑƒÑ‡ÑˆĞµ,
Ğ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ²ÑÑ‘ Ğ²Ñ€ĞµĞ¼Ñ Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ²Ğ¾Ğ·Ğ´ÑƒÑ….

ĞŸĞ¾Ğ¼Ğ½Ğ¸Ñ‚Ğµ:
{random.choice(LIGHT_PHRASES)}
""".strip()


def generate_shabbat_forecast() -> str:
    text = f"""
ğŸ•¯ï¸ Ğ¨Ğ°Ğ±Ğ±Ğ°Ñ‚Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ñ‹

Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ¾ÑĞ°Ğ´ĞºĞ¸ Ğ¸Ğ· Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹ Ğ¿Ñ€ĞµĞºÑ€Ğ°Ñ‰Ğ°ÑÑ‚ÑÑ.
Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ñ‹:
â€” Ñ‚Ñ‘Ğ¿Ğ»Ñ‹Ğ¹ ÑĞ²ĞµÑ‚
â€” Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ‹
â€” Ñ…Ğ»ĞµĞ±, Ğ²Ğ¸Ğ½Ğ¾ Ğ¸ Ğ¿Ğ°ÑƒĞ·Ñ‹

Ğ’ÑĞµ ÑÑ€Ğ¾Ñ‡Ğ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´ÑƒÑ‚.
ĞœĞ¸Ñ€ Ğ½Ğ¸ĞºÑƒĞ´Ğ° Ğ½Ğµ Ğ´ĞµĞ½ĞµÑ‚ÑÑ Ğ·Ğ° Ğ¾Ğ´Ğ¸Ğ½ Ğ²ĞµÑ‡ĞµÑ€.

{random.choice(LIGHT_PHRASES)}
""".strip()

    if maybe(0.4):
        text += f"\n\n{random.choice(UNEXPECTED_LINES)}"

    return text


def generate_forecast() -> str:
    roll = random.random()
    if roll < 0.6:
        return generate_classic_forecast()
    elif roll < 0.85:
        return generate_philosophical_forecast()
    else:
        return generate_shabbat_forecast()


# -----------------------------
# ROUTES
# -----------------------------

@router.message(Command("start"))
async def start(message: Message):
    await message.answer(
        "Ğ¯ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒÑ Ğ¸Ñ€Ğ¾Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ñ‹ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ñ‹ Ğ¿Ñ€Ğ¾ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ñ€Ğ°.\n\n"
        "ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:\n"
        "â€¢ /forecast â€” Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·\n"
        "â€¢ /shabbat â€” ÑˆĞ°Ğ±Ğ±Ğ°Ñ‚Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·\n\n"
        "ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ· ÑƒĞ½Ğ¸ĞºĞ°Ğ»ĞµĞ½."
    )


@router.message(Command("forecast"))
async def forecast(message: Message):
    await message.answer(generate_forecast())


@router.message(Command("shabbat"))
async def shabbat(message: Message):
    await message.answer(generate_shabbat_forecast())


# -----------------------------
# MAIN
# -----------------------------

async def main():
    bot = Bot(BOT_TOKEN)
    dp = Dispatcher()
    dp.include_router(router)

    logger.info("Bot started (polling)")
    await dp.start_polling(bot)


if __name__ == "__main__":
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print("Stopped")
